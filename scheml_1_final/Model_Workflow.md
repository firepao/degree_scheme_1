# 温室环境智能调控系统工作流 (Model Workflow)

本文档详细描述了基于 TPLC-Net 和 MOSSA 的温室环境智能调控系统的核心架构与工作流程。该系统旨在通过分层架构实现环境因子的精准预测与最优调控，最终在多目标约束下最大化经济效益。

## 1. 系统概览：四层架构体系

本系统采用分层解耦的设计思想，将复杂的温室调控任务划分为四个核心层次。各层协同工作，形成闭环控制流。

### Layer 1: 优化层 (Optimization Layer) - 决策大脑
- **核心组件**: MOSSA (Multi-Objective Improved Salp Swarm Algorithm)
- **功能**: 负责制定最高层级的控制策略。它不直接操作底层设备，而是根据当前环境状态、作物生长阶段及外部天气预报，计算出未来一段时间内的**最优环境设定点 (Ideal Setpoints)**。
- **目标**: 在满足作物生长安全约束的前提下，平衡作物产量收益与能源消耗成本，寻求全局最优解（即最大化净利润）。

### Layer 2: 控制层 (Control Layer) - 执行中枢
- **核心组件**: 模型预测控制 (MPC) 或 PID 控制器
- **功能**: 接收优化层下发的设定点指令，并将其转化为具体的底层执行机构动作（如风机转速、阀门开度、补光灯强度等）。
- **通过**: 该层负责消除系统扰动，确保温室内的实际环境参数（温度、湿度、CO2浓度）快速、稳定地跟踪设定目标值。

### Layer 3: 物理与预测层 (Physics & Prediction Layer) - 数字孪生
- **核心组件**: **TPLC-Net (Temporal-Physical LSTM-CNN Network)**
- **功能**: 充当温室环境的“数字模拟器”或“代理模型”。
- **传统对比**: 在传统 MPC 中，此层通常由复杂的微分方程（物理模型）构成，计算量大且难以校准。本系统是用数据驱动的深度学习模型 TPLC-Net 替代物理模型，提供毫秒级的状态预测。
- **作用**: 为优化层和控制层提供状态推演能力，即回答“如果执行这个动作，未来环境会变成什么样？”的问题。

### Layer 4: 评估层 (Evaluation Layer) - 绩效分析
- **核心组件**: 综合效益评价模型
- **功能**: 对系统的运行结果进行量化评估。
- **指标**:
  - **产量预估 (Yield Prediction)**: 基于光温积等模型的产量计算。
  - **能耗计算 (Energy Cost)**: 暖通空调、灌溉、补光等设备的累积能耗。
  - **经济效益 (Profit)**: `利润 = 预期产值 - 运行成本`。

---

## 2. TPLC-Net 的深度集成 (TPLC-Net Integration)

TPLC-Net 是系统的核心预测引擎，它革新了传统控制回路中的物理预测环节。

### 在 MPC/优化回路中的角色
在 MOSSA 寻找最优解的过程中，需要成千上万次地评估不同的环境设定点组合。
1. **传统痛点**: 传统的机理模型（First-principles models）需要求解复杂的非线性微分方程组，耗时较长，难以满足实时在线优化的需求。
2. **TPLC-Net 解决方案**:
   - **输入**: 历史环境序列 + 当前控制动作 (Action) + 外部气象干扰。
   - **输出**: 预测的未来环境状态 (Next State)。
   - **优势**: TPLC-Net 利用 LSTM 捕获时序依赖，由于是预训练的神经网络，其推理速度极快，支持 MOSSA 算法在短时间内进行大量种群迭代，从而探索更广阔的解空间。

### 架构优势
- **高精度**: 通过学习历史真实数据，能够捕获物理模型容易忽略的非线性特征。
- **泛化性**: 相比于需要针对特定温室重新标定的物理参数，TPLC-Net 可以通过数据微调快速适应不同结构的温室。

---

## 3. MOSSA 优化策略 (MOSSA Strategy)

MOSSA (Multi-Objective Strategy with Salp Swarm Algorithm) 是系统的核心决策算法。

### 优化目标设计
算法不仅关注单一指标，而是解决多目标优化问题：
$$ \text{Maximize } J = w_1 \cdot \text{Yield}(\mathbf{x}) - w_2 \cdot \text{Energy}(\mathbf{u}) $$
其中 $\mathbf{x}$ 为环境状态，$\mathbf{u}$ 为控制输入。

### 算法流程
1. **初始化 (Initialization)**: 在允许的环境设定点范围内（如温度 15°C-30°C），随机生成初始的“樽海鞘”种群（即一组候选的设定点序列）。
2. **预测评估 (Prediction & Evaluation)**:
   - 将每个候选设定点输入 **TPLC-Net**，预测该设定点下未来的环境响应。
   - 将预测结果传入**评估层**，计算预期的产量增益与能耗成本，得到适应度值 (Fitness Value)。
3. **种群迭代 (Swarm Evolution)**:
   - 模拟樽海鞘群的链式行为，领导者（Leader）向食物（当前最优解）移动，追随者（Followers）跟随领导者。
   - 这一机制保证了算法既能快速收敛（开发能力），又能有效跳出局部最优（探索能力）。
4. **决策输出 (Action)**: 经过设定的迭代次数后，输出适应度最高的设定点组合，作为控制层的最终指令。

---

## 总结
该工作流通过 **MOSSA** 实现了经济视角的顶层决策，利用 **TPLC-Net** 解决了底层物理环境的即时预测难题，并通过**分层架构**保证了系统的模块化与可扩展性。
