本文提出的基于时序周期与轻量卷积网络的温室环境变量预测模型（Greenhouse Environmental Variable Prediction Model Based on Temporal Periodicity and Lightweight Convolutional Networks）结构如图1所示。该模型首先通过多尺度序列生成模块，将原始的多变量时序数据下采样以捕捉不同时间粒度的模式。接着，尺度内一维时间序列到二维图像转换模块利用快速傅里叶变换（Fast Fourier Transform，FFT）分析序列周期性，并将1D序列重塑为2D图像以显式建模周期变化。为了便于高效处理，变量-尺度解耦重构模块对数据维度进行重组。随后，模型采用2D深度可分离卷积模块，以轻量化的方式提取2D图像中的深层特征并融合多变量信息。最后，多尺度特征融合模块将来自不同尺度的预测信息进行聚合，输出最终的温室环境变量预测结果。
![image](/3983bd11e0ff5f6d3d8781526dd2fa91d03e57b04d54bbc441c8eee91f398a77.jpg)


图1基于1维时间序列到2维图像转换和深度可分离卷积网络的多变量智能温室种植环境调控模型结构图

模型的输入为智能温室中的多变量时间序列数据，其中包括详细的温室内环境参数、作物生长相关指标及设备运行状态，例如空气湿度、空气温度、 $\mathrm{CO}_{2}$  浓度、灌溉、通风、幕布控制等，适用于本方案中温室气候建模研究方向。输入的时间序列虽然存在空缺值，但是确保了其时间戳尺度上的对应，便于本模型的训练与预测。
Module 1: 一维时间序列到二维图像转换
步骤一：多变量共同生成多尺度
针对于温室环境时间序列数据多尺度的特点，模型首先通过下采样操作，将原始长序列分段并聚合为多个不同时间粒度（尺度）的子序列。例如，从每分钟数据生成每小时、每日尺度的序列，以捕捉环境在不同时间粒度下的变化模式。
同时，为了便于后续模型针对所有变量进行统一的处理，这里需要对所有变量进行一致的多尺度生成，也就是要求我们获得所有变量的统一尺度，由于数据具有较强的相关性及良好的对应关系，这里选择对原始序列进行平均池化。针对所有的变量  $X_{0:t}^{i} \in R^{C \times T}$ ，其
中  $T$  表示序列长度,  $C$  表示变量数量, 输入时间序列  $x_{0}$  跨  $M$  尺度使用步长为 2 的卷积操
作进行逐步下采样，生成多尺度集  $X_{\dot{t}} = \left\{x_0,\dots ,x_M\right\}$  ，其中  $x_{m}\in R^{C\times L\frac{T}{2^{m}} J}$  ，具体过程如下公式所示：
$$
x _ {m} = \operatorname {C o n v} \left(x _ {m - 1}, \text {s t r i d e} = 2\right), m = 1, \dots , M
$$
# 步骤二：周期性识别
时间序列表现出复杂的多尺度和多周期动力学。多分辨率分析（Harti，1993）将时间序列建模为频域中各种周期成分的复合体。模型引入多分辨率时间图像，基于频谱分析将1D多尺度时间序列转换为2D图像，同时保留原始数据。这捕捉了时间和频域中的复杂模式，使得卷积方法能够高效地提取时间模式，并增强任务的通用性。具体如下图2所示。
![image](/7368fbf353c16c7de87e8bda32aa2a5d07294ef97c3998da52f383639d8a5d06.jpg)


图2.1维时间序列到2维图像重塑模块图

在这里，首先对每一尺度下的多变量序列  $X_{i,t}$ ，进行傅里叶变换(FFT)分析，识别出该尺度下最显著的、共享的周期性成分，将其转换成  $(M + 1)\times K$  二维图像。这将提供将1D序列转换为2D张量的依据。根据识别出的周期，将每个尺度下的1D多变量序列重塑为2D张量。具体而言，对最大的尺度序列的所有变量  $X_M^l$  首先进行归一化，然后加和得到多变量总的数值特征  $X_M^l$ ，最后对其应用快速傅里叶变换（FFT），并选择具有最高幅度的前K频率。
$$
X _ {M} ^ {l} = \sum_ {i = 1} ^ {C} \operatorname {L a y e r N o r m} \left(x _ {M} ^ {i}\right)
$$
(2)
$$
A, \left\{f _ {1}, \dots , f _ {K} \right\}, \left\{p _ {1}, \dots , p _ {K} \right\} = F F T \left(X _ {M} ^ {l}\right)
$$
(3)
其中  $A = \{A_{f_1},\dots ,A_{f_\kappa}\}$  表示振幅，  $\{f_1,\dots ,f_K\}$  是前  $K$  频率， $p_k = \int \frac{T}{f_k} ],k\in \{1,\ldots ,K\}$  表示相应的周期长度。对其他尺度下的多变量序列作同样的操作，这样，就能得到  $(M + 1)\times K$  个周期间隔的序列。
步骤三：1D到2D转换
参照 Timesnet 的思想，在利用 FFT 技术获得前  $k$  个频率及其对应的周期后，我们可以将原本一整条的序列根据周期划分成对应的序列段，然后再将相同的周期段叠加成二维的形状，也就是重塑为二维图像。具体而言，一维时间序列通过以下公式转化为二维张量：
$$
\left\{Z _ {m} ^ {l} \right\} _ {m = 0} ^ {M} = \left\{\text {R e s h a p e} _ {f _ {i}, p _ {i}} \left(\text {P a d d i n g} \left(x _ {m} ^ {l}\right)\right) \mid m = 0, \dots , M; i = 1, \dots , K \right\} (4)
$$
其中  $Padding_{m,k}(\cdot)$  表示通过在时间维度上用零扩展时间序列， $f_i$  和  $p_i$  分别表示转换后的2D张量的行数和列数。 $Z_m^l \in R^{p_i \times f_i \times C}$  表示基于频率  $f_i$  重塑的第  $i$  个时间序列，其列和行分别代表对应周期长度  $p_i$  下的区间内变化和区间间变化。最终，基于所选频率和估计周期，我们获得一组2D张量  $\{Z_m^{1,\dots}, Z_m^{k}\}$ ，这表明由不同周期导出了  $k$  种不同的时间2D变化。这种变换将两种类型的局部性引入到转换后的2D张量中，即相邻时间点（列，区间内变化）和相邻时期（行，区间间变化）的局部性。因此，时间2D变化可以很容易地通过2D核进行处理。
Module 2: 变量-尺度解耦重构
# 步骤一：通道维度转换
在经过前两个模块的处理后，我们获得了针对温室环境序列数据多尺度及多周期的分解，即  $\left(C \times (M \times K)\right)^{\prime} C$  组变量， $M$  个尺度，每个尺度下由  $K$  个二维张量组成，如果将这样的图像组输入进后续的模型，就需要在处理完尺度融合后再考虑变量之间的耦合关系显得十分复杂。产生这一问题的点就在于变量通道和尺度通道没有分离。进一步的，如果不对其做处理，直接输入到后续的2D卷积模块，每个通道的输入是  $K$  个形状不同的二维张量，难以处理。
因此，在输入到卷积模块之前，需要通道维度转换模块。我们只需要将变量通道和尺度通道分离开来，不去处理  $C$  个变量、每个变量都有  $M$  个尺度的情况，而是转而处理  $M$  个尺度、每个尺度下有  $C$  个变量的情况，这样的话由卷积模型去处理多变量的关系，最终做一个多尺度融合就好。
具体而言，本模块主要是将  $\left(C \times (M \times K)\right)$  的输入转换成  $\left(M \times (K \times C)\right)$  的形状，如下图2及公式所示：
$$
\begin{array}{l} \begin{array}{c} \iota \left\{\left[ A _ {m} ^ {k} \vee k = 0, \dots , K \right], \left[ B _ {m} ^ {k} \vee k = 0, \dots , K \right], \dots , \left[ C _ {m} ^ {k} \vee k = 0, \dots , K \right] \vee m = 0, \dots , M \right\} = \iota \\ \left( \begin{array}{l l l} A _ {m = 0} ^ {k = 1}, A _ {m = 0} ^ {k = 2} & & A _ {m = 0} ^ {k = K} \\ A _ {m = 1} ^ {k = 1}, A _ {m = 1} ^ {k = 2} & & A _ {m = 1} ^ {k = K} \\ \vdots & \vdots & \ddots \\ A _ {m = M} ^ {k = 1}, A _ {m = M} ^ {k = 2} & & A _ {m = M} ^ {k = K} \end{array} \right), \left( \begin{array}{l l l l} B _ {m = 0} ^ {k = 1} & B _ {m = 0} ^ {k = 2} & \dots & B _ {m = 0} ^ {k = K} \\ B _ {m = 1} ^ {k = 1} & B _ {m = 1} ^ {k = 2} & & B _ {m = 1} ^ {k = K} \\ \vdots & \vdots & \ddots & \vdots \\ B _ {m = M} ^ {k = 1}, B _ {m = M} ^ {k = 2} & & \dots & B _ {m = M} ^ {k = K} \end{array} \right) \dots \left( \begin{array}{l l l l l} C _ {m = 0} ^ {k = 1} & C _ {m = 0} ^ {k = 2} & \dots & C _ {m = 0} ^ {k = K} \\ C _ {m = 1} ^ {k = 1} & C _ {m = 1} ^ {k = 2} & & C _ {m = 1} ^ {k = K} \\ \vdots & \vdots & \ddots & \vdots \\ C _ {m = M} ^ {k = 1}, C _ {m = M} ^ {k = 2} & & \dots & C _ {m = M} ^ {k = K} \end{array} \right) \\ \Downarrow \\ \Downarrow \end{array} \\ \begin{array}{l} \dot {\iota} \left( \begin{array}{c c c c} A _ {m = 0} ^ {k = 1} & B _ {m = 0} ^ {k = 1} & & C _ {m = 0} ^ {k = 1} \\ A _ {m = 0} ^ {k = 2} & B _ {m = 0} ^ {k = 2} & & C _ {m = 0} ^ {k = 2} \\ \vdots & \vdots & \ddots & \vdots \\ A _ {m = 0} ^ {k = K}, B _ {m = 0} ^ {k = K} & \dots & C _ {m = 0} ^ {k = K} \end{array} \right), \left( \begin{array}{c c c c} A _ {m = 1} ^ {k = 1} & B _ {m = 1} ^ {k = 1} & & C _ {m = 1} ^ {k = 1} \\ A _ {m = 1} ^ {k = 2} & B _ {m = 1} ^ {k = 2} & & C _ {m = 1} ^ {k = K} \\ \vdots & \vdots & \ddots & \vdots \\ A _ {m = 1} ^ {k = K}, B _ {m = 1} ^ {k = K} & \dots & C _ {m = 1} ^ {k = K} \end{array} \right) \dots \left( \begin{array}{c c c c} A _ {m = M} ^ {k = 1} & B _ {m = M} ^ {k = 1} & & C _ {m = M} ^ {k = 1} \\ A _ {m = M} ^ {k = 2} & B _ {m = M} ^ {k = 2} & & C _ {m = M} ^ {k = 2} \\ \vdots & \vdots & \ddots & \vdots \\ A _ {m = M} ^ {k = K}, B _ {m = M} ^ {k = K} & \dots & C _ {m = M} ^ {k = K} \end{array} \right) \\ \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \left[ A _ {0} ^ {k}, B _ {0} ^ {k},..., C _ {0} ^ {k} ], [ A _ {1} ^ {k}, B _ {1} ^ {k},..., C _ {1} ^ {k} ],..., [ A _ {M} ^ {k}, B _ {M} ^ {k},..., C _ {M} ^ {k} ] \vee k = 0, ..., K \right] \\ (5) \end{array} \\ \end{array}
$$

变量-尺度解耦重构

![image](/a734ec55b8c0790fa65bd7eddc492a1937cc5e90612a5eb16324c230952befea.jpg)


图2变量-尺度解耦重构模块

# Module 3: 2D 深度可分离卷积
在将每个尺度下的多变量一维时间序列转换为多个二维张量后，模型需要一个高效的卷积模块来提取这些二维表征中的深层模式。传统的二维卷积在处理多通道输入时，计算成本和参数量较大，这对于需要快速响应的温室调控系统而言是一个挑战。因此，本模块引入了2D深度可分离卷积（2D Depthwise Separable Convolution），它在保持甚至提升特征提取能力的同时，显著降低了模型的计算复杂度和参数数量。模型图如图3所示。
![image](/7a8ed00ccfa1255231b44de5b21c7654770cb932b43b39f1b2d69f0c99108a9e.jpg)


图3.2D深度可分离卷积模块

2D 深度可分离卷积将标准卷积操作分解为两个独立的步骤，即深度卷积和逐点卷积。
经过通道维度转换模块后，在某一尺度  $m$  下，我们得到的输入为  $Z_{m}^{\prime}\in R^{K\times C\times P\times F}$  ，其中  $K$  是周期数量，  $C$  是变量通道数量，  $P$  和  $F$  分别是2D张量的行数和列数。为简化表示，我们考虑对其中一个周期的2D张量  $Z_{mk}\in R^{C\times P\times F}$  进行处理。
# 步骤一：通道内时空模式提取（深度卷积）
此步骤负责捕捉每个输入通道（即每个环境变量在特定周期下的2D表征）内部的时空模式。它为每一个输入通道应用一个独立的2D卷积核。例如，对于由温度数据转换而来的2D张量，深度卷积会独立地提取其周期内（行）和周期间（列）的局部变化模式，而不考虑与其他变量（如湿度、 $\mathrm{CO}_{2}$ ）的交互。具体而言，该操作对输入的  $C$  个通道分别使用  $C$  个独立的卷积核  $W_{d} \in R^{C \times 1 \times k_{h} \times k_{w}}$  （其中  $k_{h}$  和  $k_{w}$  是卷积核高和宽）进行卷积。对于
第  $c$  个通道，其计算如下：
$$
\widehat {G} _ {c} = \text {B a t c h N o r m} (\sigma (C o n v 2 D (Z _ {m k, c}, W _ {d, c})), c = 1, \dots , C
$$
其中  $Z_{mk,c}$  是输入的第  $c$  个通道， $W_{d,c}$  是专门用于该通道的深度卷积核， $\sigma$  表示激活函数 GELU（Hendrycks 和 Gimpel，2016 年）， $B_{atchNorm}$  表示批归一化操作， $\hat{G}_c$  是输出
的第  $c$  个通道特征图。这一步的输出为  $\widehat{G} \in R^{C \times P' \times F'}$
# 步骤二：跨通道特征融合（逐点卷积）
在深度卷积完成对各通道内部特征的提取后，逐点卷积（本质上是一个1x1的卷积）负责在通道维度上进行特征融合。它通过对深度卷积输出的每个像素点上的所有通道值进行线性组合，实现不同环境变量特征的有效混合。这种跨通道的信息交互对于理解温室环境中各变量之间的耦合关系至关重要。
该操作使用  $C_{out}$  个  $1 \times 1$  的卷积核  $W_{p} \in R^{C_{out} \times 1 \times 1}$  对深度卷积的输出  $\hat{G}$  进行处理，以实现通道间的特征融合与维度变换。
$$
Y _ {m k} = \text {B a t c h N o r m} (\sigma (\operatorname {C o n v} 2 D (\widehat {G}, W _ {p}))) \tag {7}
$$
最终输出  $Y_{mk} \in R^{C_{out} \times P' \times F'}$  是一个融合了多变量信息的2D特征图。
# 步骤三：多周期特征融合
上述的两步卷积是针对K个周期来说的，在每一个由FFT获得的周期上都要进行以变量为通道的深度可分离卷积，最终得到的结果也是某一周期下的特征图，需要将不同周期间的信息融合，同时要考虑周期间的重要性。这可以通过FFT的结果实现，振幅  $A$  可以反映所选频率和时段的相对重要性，从而对应于每个变换的2D张量的重要性。因此，我们根据振幅来聚合1D表示，当然在使用这个权重之前，需要先将卷积后的结果按照之前得到的 $f_{i}$  和  $p_i$  展平：
$$
X _ {m} ^ {l} = \operatorname {R e s h a p e} _ {f _ {i}, p _ {i}} (Y _ {m k}), i = 1, \dots , K \tag {8}
$$
$$
\left\{\hat {A} _ {f _ {k}} \right\} _ {k = 1} ^ {K} = \text {S o f t m a x} \left(\left\{\hat {A} _ {f _ {k}} \right\} _ {k = 1} ^ {K}\right) \tag {9}
$$
$$
x _ {m} ^ {l} = \sum_ {k = 1} ^ {K} \widehat {A} _ {f _ {k}} \circ X _ {m} ^ {l}, m = 0, \dots , M \tag {10}
$$
其中 Softmax 用于归一化权重，·表示逐元素乘法。
步骤四：多尺度特征融合
在经过上述多个模块后，我们获得了多尺度过去信息  $X^{L} = \{x_{0}^{l},\ldots ,x_{M}^{l}\}$  。由于不同尺度的序列呈现出不同的主导变化，它们的预测也呈现出不同的能力。为了充分利用多尺度信息，我们提出从多尺度序列中聚合预测，表示为：
$$
\hat {x} _ {m} = \operatorname {H e a d} _ {m} \left(x _ {m} ^ {L}\right), m = 0, \dots , M \tag {11}
$$
$$
\hat {x} = \sum_ {\substack {m = 0 \\ (12)}} ^ {M} \hat {x} _ {m}
$$
其中  $\hat{x}_m \in R^{H \times C}$  代表第  $m$  个尺度序列的未来预测，最终输出为  $\hat{x} \in R^{H \times C}$ ， $H$  代表要预测的时间步数， $\text{Head}_m(\cdot)$  表示第  $m$  个尺度序列的预测头，由线性层组成。





模块四：基于短期预测驱动的改进麻雀搜索算法 PID 参数滚动优化
在获得温室环境变量的短期多步预测结果后，需要将预测信息引入控制参数寻优过程。本模块以预测模型输出的未来环境演化趋势作为先验信息，引入改进麻雀搜索算法（Improved Sparrow Search Algorithm，ISSA），在滚动时域内对多回路 PID 控制器参数进行协同优化，实现对温室环境的前瞻性调控。
设在当前时刻 t ，预测模型基于历史观测序列 \mathbf{X}_{0:t} 输出未来 H 步的环境状态预测，得到结果如下公式所示：
Xt+1:t+H=xt+1,xt+2,…,xt+H#13
其中 {\hat{x}}_{t+h}\in{\mathbb{R}\ }^C 表示第 ℎ 步预测的多变量环境状态。该预测序列刻画了在无控制条件下环境的自然演化趋势，为后续控制参数寻优提供前瞻性约束。具体如图5所示。
 
图5. 基于短期预测驱动的改进麻雀搜索算法 PID 参数滚动优化模块
步骤一：改进麻雀搜索算法原理
麻雀搜索算法是一种先进的群优化算法，将种群划分为发现者、加入者和警戒者三类个体，通过角色分工实现全局搜索与局部开发的平衡。其中，发现者负责在参数空间中进行全局搜索，为控制系统提供潜在的高性能参数区域，适应度较优的个体更有可能承担该角色；加入者围绕发现者展开局部搜索，加速对优良 PID 参数组合的挖掘；警戒者随机分布于种群中，用于监测环境或适应度突变，当系统状态发生剧烈变化或搜索陷入局部最优时，通过位置重构引导种群跳出不利区域。这种机制使得 SSA 在处理 PID 参数寻优问题时，具有极强的鲁棒性和寻优精度。
针对标准 SSA 在迭代后期种群多样性降低的问题，提出自适应 t-分布变异，在位置更新后引入变异操作，增强算法跳出局部极值的能力，确保能找到全局最优的 PID 参数组合。该策略的核心思想是将算法当前的迭代次数 t 直接作为 t-分布的自由度参数，利用t-分布形态随自由度变化的数学特性，在位置更新后引入动态扰动，从而增强算法跳出局部约束的能力并确保全局收敛。
在每一次迭代计算完成后，选取当前种群中处于最优位置的个体 X_{best} 进行变异操作，以生成潜在的新位置 X_{best}^\prime。其数学表达式定义为：
Xbest'=Xbest+Xbest⋅Tt#14
式中，X_{best} 为当前全局最优解，T\left(t\right) 表示自由度参数为当前迭代次数 t 的t-分布随机数。此公式表明，变异强度直接受控于当前的迭代进程，通过引入随机性扰动来丰富种群的搜索路径。
该策略通过自由度的动态变化实现了算法搜索行为的自适应调节。在迭代初期，由于迭代次数 t 较小，t-分布的自由度较低，其概率密度曲线呈现出显著的长尾特征。这意味着算法有较高的概率产生较大的突变步长，从而赋予了种群极强的全局探索能力，有助于快速跳出潜在的局部最优陷阱。而在迭代后期，随着\ t 的不断增加，t-分布的形态逐渐收敛并逼近标准正态分布。此时，变异产生的扰动步长变小且更加集中，使得算法行为平滑过渡到在最优解邻域内的微小精细化搜索，从而显著提高了PID控制参数的最终收敛精度。
此外，为确保变异操作不会破坏已有的寻优成果，算法引入了贪婪选择策来决定位置更新。即计算变异后新位置的适应度值 F\left(X_{best}^\prime\right)，并与原最优位置的适应度值 F\left(X_{best}\right) 进行比较：若新位置更优（即 F\left(X_{best}^\prime\right)<F\left(X_{best}\right)），则用 X_{best}^\prime 替换原最优位置；否则，保持原位置不变。通过上述机制的协同作用，改进后的ISSA算法能够有效平衡搜索初期的多样性维持与末期的收敛速度，最终为温室环境控制系统精确寻找到全局最优的PID参数组合。
步骤二：PID 参数协同寻优
在参数协同寻优框架下，底层控制采用经典比例–积分–微分（PID）控制器，其控制律可表示为
ut=Kpet+Ki0tetdt+Kddetdt#15
其中 e\left(t\right) 表示环境变量的设定值与实际测量值之间的偏差。比例项用于快速抑制当前误差，积分项用于消除稳态偏差，微分项则用于抑制系统超调并提升动态响应稳定性。考虑到温室系统中温度、湿度、光照等变量之间存在显著耦合关系，本方案采用并行多回路 PID 控制结构。以温度与湿度控制为例，其 PID 参数被统一编码为麻雀个体的位置向量：
Zj=KpT,KiT,KdT,KpRh,KiRh,KdRhj#16
其中，T 和 Rh 分别代表温度和湿度控制，每一个麻雀个体对应一组完整的控制器参数配置，其优劣由预测驱动的综合性能指标进行评价。在预测时域 𝐻 内，构建综合性能评价函数作为ISSA 的适应度函数：
F=h=1HωTTt+h-Toptt+h2+ωRhRht+h-Rhoptt+h2+λh=1Hut+h-ut+h-12#17
其中 T_{opt} 与 {Rh}_{opt} 为依据作物生理需求设定的动态目标轨迹，第二项用于约束控制输入变化幅度，避免执行机构频繁启停和剧烈动作。
在每一个控制周期内，ISSA 算法在预测模型构建的“虚拟温室环境”[振杨2.1]中对麻雀个体进行迭代更新，寻找使适应度函数 F 最小的个体位置：
Z*=arg minZjF#18
得到的最优个体 \mathbf{Z}^\ast 被解析为当前时刻的 PID 参数组合，并下发至底层控制器。控制器根据实时测量误差计算控制量，驱动风机、加热、加湿等执行机构完成环境调控。随着系统进入下一时域 ，重新采集环境数据并更新短期预测结果，ISSA-PID 参数寻优过程随之滚动执行，从而形成“预测—优化—控制”闭环机制。该方法使控制系统能够在环境扰动发生前提前调整控制策略，显著提升温室环境调控的稳定性与自适应能力。
